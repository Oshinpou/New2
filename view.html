<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Imacx Digital Page Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
    }
    input, textarea, select {
      display: block;
      margin-bottom: 10px;
      padding: 8px;
      width: 100%;
    }
    button {
      padding: 10px 15px;
      margin: 5px 0;
      cursor: pointer;
    }
    .link-card {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .link-card a {
      word-break: break-all;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ Imacx Page Generator</h1>

  <input id="title" placeholder="Page Title (e.g., Imacx Star)" />
  <textarea id="details" placeholder="Details (short description)"></textarea>
  <input id="image" placeholder="Image URL" />
  <input id="price" placeholder="Price (e.g., â‚¹1999)" />
  <input id="variants" placeholder="Variants (e.g., Red,Blue,Green)" />
  <button onclick="generatePage()">Generate Page</button>

  <h2>ğŸ”— Generated Pages</h2>
  <div id="links"></div>

  <hr />
  <button id="export-btn">ğŸ“¤ Export All Pages</button>
  <input type="file" id="import-input" style="display:none;" />
  <button id="import-btn">ğŸ“¥ Import Pages</button>

  <script>
    const gun = Gun();
    const baseURL = location.origin + location.pathname.replace(/[^/]+$/, '');

    function generatePage() {
      const id = 'page_' + Date.now();
      const title = document.getElementById('title').value.trim();
      const details = document.getElementById('details').value.trim();
      const image = document.getElementById('image').value.trim();
      const price = document.getElementById('price').value.trim();
      const variants = document.getElementById('variants').value.trim();

      if (!title || !details) {
        alert("Title and details required");
        return;
      }

      const pageData = {
        id,
        title,
        details,
        image,
        price,
        variants
      };

      gun.get(id).put(pageData);
      gun.get("index").set(gun.get(id));

      displayLinks();
    }

    function displayLinks() {
      document.getElementById('links').innerHTML = '';
      gun.get("index").map().once((data, key) => {
        if (!data || !data.id) return;
        const linkDiv = document.createElement('div');
        linkDiv.className = "link-card";

        const link = document.createElement('a');
        link.href = baseURL + '?id=' + data.id;
        link.target = "_blank";
        link.textContent = baseURL + '?id=' + data.id;

        const del = document.createElement('button');
        del.textContent = 'ğŸ—‘ï¸ Delete';
        del.onclick = () => {
          gun.get(data.id).put(null);
          gun.get("index").get(data.id).put(null);
          displayLinks();
        };

        linkDiv.appendChild(link);
        linkDiv.appendChild(document.createElement('br'));
        linkDiv.appendChild(del);
        document.getElementById('links').appendChild(linkDiv);
      });
    }

    function renderPageFromURL() {
      const params = new URLSearchParams(window.location.search);
      const pageId = params.get("id");
      if (!pageId) return;

      document.body.innerHTML = '<p>Loading page...</p>';
      gun.get(pageId).once(data => {
        if (!data) {
          document.body.innerHTML = '<h1>This page was deleted or does not exist</h1>';
          return;
        }
        document.body.innerHTML = `
          <nav style="padding: 15px; background: #222; color: white;">
            <h2>âœ¨ ${data.title}</h2>
          </nav>
          <div style="padding: 20px;">
            <img src="${data.image}" alt="Image" style="max-width:100%; border-radius:10px;" />
            <p>${data.details}</p>
            <h3>Price: ${data.price}</h3>
            <p><strong>Variants:</strong> ${data.variants}</p>
          </div>
        `;
      });
    }

    function exportPages() {
      const allData = {};
      gun.get("index").map().once((product, id) => {
        if (!product || !id) return;
        gun.get(id).once(data => {
          allData[id] = data;
          if (Object.keys(allData).length > 0) {
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'imacx_pages_backup.json';
            a.click();
          }
        });
      });
    }

    function importPages(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = JSON.parse(e.target.result);
        for (const id in data) {
          const entry = data[id];
          gun.get(id).put(entry);
          gun.get("index").set(gun.get(id));
        }
        alert('âœ… Pages imported successfully!');
        displayLinks();
      };
      reader.readAsText(file);
    }

    // Setup event listeners
    if (!window.location.search.includes('id=')) {
      displayLinks();
      document.getElementById('export-btn').addEventListener('click', exportPages);
      document.getElementById('import-btn').addEventListener('click', () => document.getElementById('import-input').click());
      document.getElementById('import-input').addEventListener('change', importPages);
    } else {
      renderPageFromURL();
    }
  </script>
</body>
</html>
