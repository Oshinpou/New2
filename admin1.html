<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Orders - Page 1</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    input, textarea, select { margin: 5px 0; width: 100%; padding: 6px; }
    button { margin-top: 10px; }
    .order { border: 1px solid #ccc; padding: 10px; margin: 10px 0; background: #fff; }
  </style>
</head>
<body>
  <h2>Create Order (Admin Page 1)</h2>

  <input id="orderId" placeholder="Order ID" />
  <textarea id="items" rows="4" placeholder="Items (format: name|qty|price|color|size, separate by newlines)"></textarea>
  <input id="category" placeholder="Category" />
  <input id="subcategory" placeholder="Subcategory" />
  <input id="status" placeholder="Order Status" />
  <button onclick="saveOrder()">Save Order</button>

  <hr>
  <input id="searchId" placeholder="Search Order ID" />
  <button onclick="searchOrder()">Search</button>
  <div id="orderResults"></div>

  <script>
    const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
    const pageKey = 'admin1-orders';

    function parseItems(raw) {
      return raw.split('\n').map(line => {
        const [name, qty, price, color, size] = line.split('|');
        return { name, qty, price, color, size };
      });
    }

    function saveOrder() {
      const id = document.getElementById('orderId').value.trim();
      const itemsRaw = document.getElementById('items').value;
      const items = parseItems(itemsRaw);
      const category = document.getElementById('category').value;
      const subcategory = document.getElementById('subcategory').value;
      const status = document.getElementById('status').value;

      const total = items.reduce((sum, item) => sum + Number(item.price || 0) * Number(item.qty || 0), 0);

      gun.get(pageKey).get(id).put({ id, items, category, subcategory, status, total });
      alert('Order saved!');
    }

    function searchOrder() {
      const id = document.getElementById('searchId').value.trim();
      document.getElementById('orderResults').innerHTML = '';

      gun.get(pageKey).get(id).once(data => {
        if (!data) return alert('Order not found here');
        displayOrder(data, true);
      });
    }

    function displayOrder(order, showDelete = true) {
      const div = document.createElement('div');
      div.className = 'order';
      div.innerHTML = `
        <strong>Order ID:</strong> ${order.id}<br>
        <strong>Status:</strong> ${order.status}<br>
        <strong>Category:</strong> ${order.category}<br>
        <strong>Subcategory:</strong> ${order.subcategory}<br>
        <strong>Total:</strong> ₹${order.total}<br>
        <strong>Items:</strong><br>
        <ul>
          ${order.items.map(item => `<li>${item.name} - ${item.qty} x ₹${item.price} [${item.color}, ${item.size}]</li>`).join('')}
        </ul>
        ${showDelete ? `<button onclick="deleteOrder('${order.id}')">Delete Order</button>` : ''}
      `;
      document.getElementById('orderResults').appendChild(div);
    }

    function deleteOrder(orderId) {
      if (!confirm('Are you sure you want to delete this order?')) return;
      gun.get(pageKey).get(orderId).put(null);
      alert('Order deleted!');
      document.getElementById('orderResults').innerHTML = '';
    }
  </script>
</body>
</html>
