<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Orders - Imacx</title>
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.1/dist/pouchdb.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }
    .order {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: white;
    }
    .order h3 {
      margin-top: 0;
    }
    .status-btn {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 6px 12px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    .status-btn:hover {
      background-color: #45a049;
    }
    input[type="text"] {
      padding: 8px;
      width: 250px;
      margin-bottom: 20px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>Admin Order Panel</h1>
  <input type="text" id="search" placeholder="Search by Order ID..." oninput="filterOrders()">

  <div id="orders"></div>

  <script>
    const db = new PouchDB('orders');

    async function fetchOrders() {
      const container = document.getElementById('orders');
      container.innerHTML = '';
      try {
        const result = await db.allDocs({ include_docs: true });
        result.rows.forEach(row => {
          if (row.doc && row.doc._id.startsWith('order_')) {
            displayOrder(row.doc);
          }
        });
      } catch (err) {
        console.error('Failed to fetch orders:', err);
      }
    }

    function displayOrder(order) {
      const container = document.getElementById('orders');

      const orderDiv = document.createElement('div');
      orderDiv.className = 'order';
      orderDiv.dataset.orderId = order._id;

      orderDiv.innerHTML = `
        <h3>Order ID: ${order._id}</h3>
        <p><strong>Name:</strong> ${order.name || ''}</p>
        <p><strong>Email:</strong> ${order.email || ''}</p>
        <p><strong>Product:</strong> ${order.product || ''}</p>
        <p><strong>Status:</strong> <span class="status-text">${order.status || 'pending'}</span></p>
        <button class="status-btn" onclick="updateStatus('${order._id}')">Mark as Shipped</button>
      `;

      container.appendChild(orderDiv);
    }

    async function updateStatus(orderId) {
      try {
        const order = await db.get(orderId);
        order.status = 'shipped';
        await db.put(order);
        fetchOrders(); // Refresh display
      } catch (err) {
        console.error('Error updating order:', err);
      }
    }

    function filterOrders() {
      const searchValue = document.getElementById('search').value.trim().toLowerCase();
      const orders = document.querySelectorAll('.order');
      orders.forEach(order => {
        const orderId = order.dataset.orderId.toLowerCase();
        order.style.display = orderId.includes(searchValue) ? 'block' : 'none';
      });
    }

    fetchOrders();
  </script>
</body>
</html>
