<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Orders Panel</title>
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.1/dist/pouchdb.min.js"></script>
  <script>
    const db = new PouchDB('orders');

    function loadOrders(filterId = '') {
      db.allDocs({ include_docs: true }).then(result => {
        const container = document.getElementById("ordersContainer");
        container.innerHTML = "";

        const orders = result.rows
          .map(row => row.doc)
          .filter(doc => filterId ? doc._id.includes(filterId) : true);

        if (orders.length === 0) {
          container.innerHTML = "<p>No orders found.</p>";
          return;
        }

        orders.forEach(order => {
          const div = document.createElement("div");
          div.className = "order-card";
          div.style = "border:1px solid #ccc; padding:10px; margin:10px; border-radius:8px";

          div.innerHTML = `
            <p><strong>Order ID:</strong> ${order._id}</p>
            <p><strong>Name:</strong> ${order.name || "N/A"}</p>
            <p><strong>Price:</strong> â‚¹${order.price || "0"}</p>
            <p><strong>Description:</strong> ${order.description || "N/A"}</p>
            <p><strong>Status:</strong> ${order.status || "Pending"}</p>

            <select id="status_${order._id}">
              <option value="Pending" ${order.status === "Pending" ? "selected" : ""}>Pending</option>
              <option value="Shipped" ${order.status === "Shipped" ? "selected" : ""}>Shipped</option>
              <option value="Delivered" ${order.status === "Delivered" ? "selected" : ""}>Delivered</option>
              <option value="Cancelled" ${order.status === "Cancelled" ? "selected" : ""}>Cancelled</option>
            </select>
            <button onclick="updateStatus('${order._id}')">Update Status</button>
          `;

          container.appendChild(div);
        });
      });
    }

    function updateStatus(orderId) {
      db.get(orderId).then(doc => {
        const newStatus = document.getElementById(`status_${orderId}`).value;
        doc.status = newStatus;
        return db.put(doc);
      }).then(() => {
        alert("Order status updated");
        loadOrders(); // reload to reflect changes
      }).catch(err => {
        console.error("Failed to update:", err);
        alert("Failed to update order");
      });
    }

    function searchOrder() {
      const id = document.getElementById("searchInput").value.trim();
      loadOrders(id);
    }

    window.onload = () => {
      loadOrders();
    }
  </script>
</head>
<body style="font-family:sans-serif;padding:20px;">
  <h1>Admin Panel - All Orders</h1>
  
  <div style="margin-bottom:20px;">
    <input type="text" id="searchInput" placeholder="Search Order ID..." />
    <button onclick="searchOrder()">Search</button>
    <button onclick="loadOrders()">Show All</button>
  </div>

  <div id="ordersContainer"></div>
</body>
</html>
